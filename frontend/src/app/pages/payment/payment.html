<section class="container-navbar">
  <app-nav-bar></app-nav-bar>
  <div class="img-container">
    <p>iAcademIA</p>
    <img src="icons/logoBlancoAmarillo.png" alt="AcademIA Logo" class="logo"/>
  </div>
</section>

<section class="d-grid gap-4 justify-items-center" style="grid-template-columns: 1.5fr 1fr;">
    <aside class="aside-container-data bg-white rounded-3 border mt-5 px-5 pt-3 pb-2" style="margin-left: 100px;">
        <section class="mt-3">
            <form class="signup-form d-flex flex-column w-100" [formGroup]="registerPaymentForm" (ngSubmit)="onSubmit()">

                <div class="w-100 d-flex flex-column align-items-start mb-3">
                    <label class="form-label" for="howDidYouFindUs">
                        ¿Donde nos viste?
                    </label>
                    <select
                        class="form-select w-50"
                        required
                        id="howDidYouFindUs"
                        name="howDidYouFindUs"
                        formControlName="howDidYouFindUs"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('howDidYouFindUs')?.invalid && registerPaymentForm.get('howDidYouFindUs')?.touched}">

                        <option [ngValue]="null">Selecciona</option>
                        <option value="Referido AsedUIS">Referido AsedUIS</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="X">X</option>
                        <option value="Un amigo me conto">Un amigo me conto</option>
                        <option value="Otro">Otro</option>
                    </select>

                    @if(registerPaymentForm.get('howDidYouFindUs')?.invalid && registerPaymentForm.get('howDidYouFindUs')?.touched){
                        <div class="invalid-feedback">
                            Debes selecciona una opción.
                        </div>
                    }
                    
                </div>

                <div class="my-3"><h3 class="text-body">Informacion personal</h3></div>

                <div class="d-flex w-100 justify-content-between mb-3">
                    <div class="form-group" style="width: 48%;">
                        <label class="form-label" for="name">Nombre</label>
                        <input
                            class="form-control"
                            type="text"
                            id="name"
                            name="name"
                            placeholder="Nombre"
                            required
                            formControlName="firstName"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('firstName')?.invalid && registerPaymentForm.get('firstName')?.touched}">

                        @if(registerPaymentForm.get('firstName')?.invalid && registerPaymentForm.get('firstName')?.touched){
                        <div class="invalid-feedback">
                            El nombre es obligatorio.
                        </div>
                        }

                    </div>

                    <div class="form-group" style="width: 48%;">
                        <label class="form-label" for="lastname">Apellido</label>
                        <input
                            class="form-control"
                            type="text"
                            id="lastname"
                            name="lastname"
                            placeholder="Apellido"
                            required
                            formControlName="lastName"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('lastName')?.invalid && registerPaymentForm.get('lastName')?.touched}">

                         @if(registerPaymentForm.get('lastName')?.invalid && registerPaymentForm.get('lastName')?.touched){
                            <div class="invalid-feedback">
                                El apellido es obligatorio.
                            </div>
                        }
                    </div>
                </div>

                <div class="form-group w-100 mb-3">
                    <label class="form-label" for="email">Correo</label>
                    <input
                        class="form-control"
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Correo"
                        required
                        formControlName="email"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('email')?.invalid && registerPaymentForm.get('email')?.touched}">

                        @if(registerPaymentForm.get('email')?.invalid && registerPaymentForm.get('email')?.touched){
                            <div class="invalid-feedback">
                                @if(registerPaymentForm.get('email')?.errors?.['required']){
                                    El correo es obligatorio.
                                }@else if(registerPaymentForm.get('email')?.errors?.['email']){
                                    El formato del correo es inválido. Debe ser similar a: ejemplo@dominio.com
                                }
                            </div>
                        }

                </div>

                <div class="form-group w-100 mb-3">
                    <label class="form-label" for="username">Usuario</label>
                    <input
                        class="form-control"
                        type="username"
                        id="username"
                        name="username"
                        placeholder="Usuario"
                        required
                        formControlName="username"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('username')?.invalid && registerPaymentForm.get('username')?.touched}">

                         @if(registerPaymentForm.get('username')?.invalid && registerPaymentForm.get('username')?.touched){
                            <div class="invalid-feedback">
                                El usuario es obligatorio.
                            </div>
                        }

                </div>

                <div class="form-group w-100 mb-3">
                    <label class="form-label" for="cellphone">Telefono celular</label>
                    <div class="input-group" formGroupName="cellphone">
                        <select
                            class="form-select px-4"
                            style="width: 20%; font-size: 18px;"
                            type="text"
                            id="phoneCode"
                            name="phoneCode"
                            required
                            formControlName="extension"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('phone.extension')?.invalid && registerPaymentForm.get('phone.extension')?.touched}">
                        

                            @for(country of countrysArray(); track country.id){
                                @if(country.name === "Colombia"){   
                                    <option [ngValue]="country.phoneCode" selected style="font-size: 18px;">{{country.emoji + " " + country.phoneCode}}</option>
                                }@else{
                                    <option [ngValue]="country" style="font-size: 18px;">{{country.emoji + ' ' + country.phoneCode}}</option>
                                }
                            }
                            
                        </select>

                        <input
                            class="form-control w-75"
                            type="tel"
                            id="phoneNumber"
                            name="phoneNumber"
                            placeholder="Telefono celular"
                            required
                            formControlName="phoneNumber"
                            [ngClass]="{'is-invalid': (registerPaymentForm.get('cellphone.phoneNumber')?.invalid && registerPaymentForm.get('cellphone.phoneNumber')?.touched) || registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['maxlength'] ||registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['minlength']}">

                        
                        @if((registerPaymentForm.get('cellphone.phoneNumber')?.invalid && registerPaymentForm.get('cellphone.phoneNumber')?.touched) || registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['maxlength'] ||registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['minlength']){
                            <div class="invalid-feedback">
                                @if(registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['maxlength'] || registerPaymentForm.get('cellphone.phoneNumber')?.errors?.['minlength']){
                                    El telefono celular debe tener 10 digitos.
                                }@else{
                                    El telefono celular es obligatorio.
                                }
                            </div>
                        }
                    
                    </div>

                    
                </div>

                <div class="form-group w-100 mb-3">
                    <label class="form-label" for="phone">Telefono fijo</label>
                    <input
                        class="form-control"
                        type="tel"
                        id="phone"
                        name="phone"
                        placeholder="Telefono fijo"
                        required
                        formControlName="phone"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('phone')?.invalid && registerPaymentForm.get('phone')?.touched}">

                         @if((registerPaymentForm.get('phone')?.invalid && registerPaymentForm.get('phone')?.touched) || registerPaymentForm.get('phone')?.errors?.['maxlength'] ||registerPaymentForm.get('phone')?.errors?.['minlength']){
                            <div class="invalid-feedback">
                                @if(registerPaymentForm.get('phone')?.errors?.['maxlength'] || registerPaymentForm.get('phone')?.errors?.['minlength']){
                                    El telefono fijo debe tener 10 digitos.
                                }@else{
                                    El telefono fijo es obligatorio.
                                }
                            </div>
                        }

                </div>


                <div class="d-flex w-100 justify-content-between mb-3">
                    <div class="form-group" style="width: 48%;">
                        <label class="form-label" for="nativeCountry">Pais de nacimiento</label>
                        <select 
                            class="form-select" 
                            type="text" 
                            id="nativeCountry" 
                            name="nativeCountry" 
                            required 
                            [(ngModel)]="currentCountry" 
                            [ngModelOptions]="{standalone: true}"
                            (blur)="onCountrySelectTouch()" 
                            [ngClass]="{'is-invalid': currentCountry() === null && countryTouched}"
                            >
                            <option [ngValue]="null">Selecciona</option>

                            @for(country of countrysArray(); track country.id){
                                <option [ngValue]="country">{{country.name}}</option>
                            }

                        </select>

                        @if(currentCountry() === null && countryTouched){
                            <div class="invalid-feedback ">
                                El país de nacimiento es obligatorio.
                            </div>
                        }

                    </div>

                    <div class="form-group" style="width: 48%;">
                        <label class="form-label" for="nationality">Nacionalidad</label>
                        <input
                            class="form-control no-clickable"
                            type="text"
                            id="nationality"
                            name="nationality"
                            [placeholder]="currentNationality() || 'Nacionalidad'"
                            required
                            formControlName="nationality"
                            >
                    </div>

                </div>

                <div class="form-group w-100 mb-3">
                    <label class="form-label" for="documentType">Documento de identidad</label>
                    <div class="input-group d-flex">
                        <select
                            class="form-select text-start w-50"
                            type="text"
                            id="documentType"
                            name="documentType"
                            required
                            formControlName="documentType"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('documentType')?.invalid && registerPaymentForm.get('documentType')?.touched}">
                            
                            <option [ngValue]="null">Selecciona</option>

                            @for(docType of documentTypes(); track docType.id){
                                <option [ngValue]="docType.cod">{{docType.name}}</option>
                            }
                            </select>

                        <input
                            class="form-control w-50"
                            type="number"
                            id="docuemntNumber"
                            name="DocumentNumber"
                            placeholder="Documento"
                            required
                            formControlName="documentNumber"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('documentNumber')?.invalid && registerPaymentForm.get('documentNumber')?.touched}">

                         @if((registerPaymentForm.get('documentType')?.invalid && registerPaymentForm.get('documentType')?.touched) || (registerPaymentForm.get('documentNumber')?.invalid && registerPaymentForm.get('documentNumber')?.touched)){
                            <div class="invalid-feedback">
                                Debes seleccionar el tipo y digitar el número de documento.
                            </div>
                        }

                    </div>

                </div>

                <div class="form-group mb-3">
                    <label class="form-label" for="password">Contraseña</label>
                    <input
                        class="form-control"
                        type="password"
                        id="password"
                        name="password"
                        placeholder="Contraseña"
                        required
                        formControlName="password"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('password')?.invalid && registerPaymentForm.get('password')?.touched}">

                    @if(registerPaymentForm.get('password')?.invalid && registerPaymentForm.get('password')?.touched){
                        <div class="invalid-feedback">
                            @if(registerPaymentForm.get('password')?.errors?.['required']){
                                La contraseña es obligatoria.
                            }@else if(registerPaymentForm.get('password')?.errors?.['minlength'] || registerPaymentForm.get('password')?.errors?.['maxlength']){
                                Debe tener entre 8 y 72 caracteres.
                            }@else if(registerPaymentForm.get('password')?.errors?.['noLetter']){
                                Debe contener al menos una letra mayuscula y minuscula (A-Z, a-z).
                            }@else if(registerPaymentForm.get('password')?.errors?.['noNumber']){
                                Debe contener al menos un número (0-9).
                            }
                        </div>
                    }
                    
                </div>

                <div class="form-group mb-3">
                    <label class="form-label" for="confirmPassword">Confirma tu contraseña</label>
                    <input
                        class="form-control"
                        type="password"
                        id="confirmPassword"
                        name="confirmPassword"
                        placeholder="Confirma tu contraseña"
                        required
                        formControlName="confirmPassword"
                        [ngClass]="{'is-invalid': registerPaymentForm.get('confirmPassword')?.invalid && registerPaymentForm.get('confirmPassword')?.touched}">
                    
                    @if(registerPaymentForm.get('confirmPassword')?.invalid && registerPaymentForm.get('confirmPassword')?.touched){
                        <div class="invalid-feedback">
                            @if(registerPaymentForm.get('confirmPassword')?.errors?.['mismatch']){
                                
                                    Las contraseñas no coinciden.
                                
                                } @else{
                                        Confirma tu contraseña.
                                }
                        </div>
                    }

                </div>

                

                <div class="my-3" formGroupName="address">
                    <h3 class="text-body">Informacion de facturacion</h3>

                    <div class="form-group w-100 my-3">
                        <label class="form-label" for="street">Direccion</label>
                        <input
                            class="form-control"
                            type="text"
                            id="street"
                            name="street"
                            placeholder="Direccion"
                            required
                            formControlName="street"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('address.street')?.invalid && registerPaymentForm.get('address.street')?.touched}">
                        
                        @if(registerPaymentForm.get('address.street')?.invalid && registerPaymentForm.get('address.street')?.touched){
                            <div class="invalid-feedback">
                                La dirección es obligatoria.
                            </div>
                        }

                    </div>

                    <div class="form-group w-100 mb-3">
                        <label class="form-label" for="country">Pais de residencia</label>
                        <select
                            class="form-select"
                            type="text"
                            id="country"
                            name="country"
                            required
                            formControlName="country"
                            [ngClass]="{'is-invalid': registerPaymentForm.get('address.country')?.invalid && registerPaymentForm.get('address.country')?.touched}">
                            
                            <option [ngValue]="null">Selecciona</option>

                            @for(country of countrysArray(); track country.id){
                                <option [ngValue]="country">{{country.name}}</option>
                            }

                        </select>

                        @if(registerPaymentForm.get('address.country')?.invalid && registerPaymentForm.get('address.country')?.touched){
                            <div class="invalid-feedback">
                                El país de residencia es obligatorio.
                            </div>
                        }

                    </div>

                    <div class="d-flex w-100 justify-content-between mb-3">
                        <div class="form-group" style="width: 48%;">
                            <label class="form-label" for="state">Departamento</label>
                            <select
                                class="form-select"
                                type="text"
                                id="state"
                                name="state"
                                required
                                formControlName="state"
                                [ngClass]="{'is-invalid': registerPaymentForm.get('address.state')?.invalid && registerPaymentForm.get('address.state')?.touched}">
                                
                                <option [ngValue]="null">Selecciona</option>
                                
                                @for(state of statesArray(); track state.id){
                                    <option [ngValue]="state">{{state.name}}</option>
                                }
                            
                            </select>

                            @if(registerPaymentForm.get('address.state')?.invalid && registerPaymentForm.get('address.state')?.touched){
                                <div class="invalid-feedback">
                                    El departamento es obligatorio.
                                </div>
                            }

                        </div>

                        <div class="form-group" style="width: 48%;">
                            <label class="form-label" for="city">Ciudad</label>
                            <select
                                class="form-select"
                                type="text"
                                id="city"
                                name="city"
                                required
                                formControlName="city"
                                [ngClass]="{'is-invalid': registerPaymentForm.get('address.city')?.invalid && registerPaymentForm.get('address.city')?.touched}">
                                
                                <option [ngValue]="null">Selecciona</option>

                                @for(city of citiesArray(); track city.id){
                                    <option [ngValue]="city">{{city.name}}</option>
                                }
                            
                            </select>

                            @if(registerPaymentForm.get('address.city')?.invalid && registerPaymentForm.get('address.city')?.touched){
                                <div class="invalid-feedback">
                                    La ciudad es obligatoria.
                                </div>
                            }

                        </div>
                    </div>
                </div>
                
                <section class="mb-3">
                    <h3 class="text-body mb-3" >Selecciona un metodo de pago</h3>
                    <div class="d-grid w-100 gap-4" style="grid-template-columns: 1fr 1fr 1fr 1fr;">                      
                        <button class="btn btn-paiment-type" id="PSE" data-view="view-pse" routerLink="pse" (click)="selectPayment('PES')" [ngClass]="{'active-button-style': activePaymentId === 'PES'}" type="button">
                            <img src="svg/PSE.svg" alt="Logo PSE" width="80" height="80">
                        </button>

                        <button class="btn btn-paiment-type px-3" id="cards" data-view="view-cards" routerLink="debit-credit-card" (click)="selectPayment('cards')" [ngClass]="{'active-button-style': activePaymentId === 'cards'}" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 32 32"><path fill="currentColor" d="M2 9.5A4.5 4.5 0 0 1 6.5 5h19A4.5 4.5 0 0 1 30 9.5v13a4.5 4.5 0 0 1-4.5 4.5h-19A4.5 4.5 0 0 1 2 22.5v-13ZM6.5 7A2.5 2.5 0 0 0 4 9.5V11h24V9.5A2.5 2.5 0 0 0 25.5 7h-19ZM4 22.5A2.5 2.5 0 0 0 6.5 25h19a2.5 2.5 0 0 0 2.5-2.5V13H4v9.5ZM21 19h3a1 1 0 1 1 0 2h-3a1 1 0 1 1 0-2Z"/></svg>
                            <p class="DebitoCredito">Debito / Credito</p>
                        </button>

                        <button class="btn btn-paiment-type" id="daviplata" data-view="view-daviplata" routerLink="daviplata" (click)="selectPayment('daviplata')" [ngClass]="{'active-button-style': activePaymentId === 'daviplata'}" type="button">
                            <img src="svg/daviplata.svg" alt="Logo Daviplata" width="80" height="80">
                        </button>

                        <button class="btn btn-paiment-type" id="paymentPlus" data-view="view-plus" (click)="selectPayment('paymentPlus')" [ngClass]="{'active-button-style': activePaymentId === 'paymentPlus'}" style="font-size: 40px;" type="button" disabled>+</button>
                    </div>

                    @if(registerPaymentForm.get('paymentMethod')?.valid && registerPaymentForm.get('paymentDetails')?.invalid && registerPaymentForm.get('paymentDetails')?.touched){
                        <div class="invalid-feedback mt-2">
                            Por favor, completa los detalles del método de pago seleccionado.
                        </div>
                    }

                </section>
                
                <router-outlet></router-outlet>

                <section class="mt-4 w-100">
                    <h6 class="text-body-secondary">Detalles de la compra</h6>
                    <div class="border-top border-bottom py-2">
                        <div class="d-flex justify-content-between mb-2">
                            <p style="font-size: 16px;">Diplomado en inteligencia artificial</p>
                            <p style="font-size: 16px;">$ 1.339.618,00</p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-size: 16px;">Cupon de descuento (12%)</p>
                            <p style="font-size: 16px;">$ -300.400</p>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-2">
                        <p style="font-size: 16px;">Total a pagar</p>
                        <p style="font-size: 16px;">$ 1.039.618,00</p>
                    </div>

                </section>

                <div class="w-100 my-4">
                    <button class="btn btn-primary w-100 signup-button" type="submit" [disabled]="!registerPaymentForm.valid">Comprar ahora</button>
                </div>

            </form>
        </section>

    </aside>

    <aside class="aside-container-data d-flex flex-column align-content-center aling-items-center me-5 mt-5" style="margin-right: 100px;">
        <div class="w-100 bg-dblue h-auto rounded-4 py-3 px-4">
            <h3 class="text-light text-center mb-3">VIBECODING</h3>
            @for(text of textsVibecodingArray(); track text.id){
                <div class="d-flex mb-2">
                    <div class="d-flex justify-content-start align-items-center me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="#000000"><g fill="none" stroke="#FFD300" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="m15.75 9.749l-3.981 5.308a.75.75 0 0 1-1.13.08L8.25 12.749"/><path d="M10.73 1.357a1.63 1.63 0 0 1 2.54 0l1.512 1.881a1.63 1.63 0 0 0 1.446.6l2.4-.261a1.63 1.63 0 0 1 1.8 1.8l-.261 2.4a1.63 1.63 0 0 0 .6 1.446l1.881 1.512a1.63 1.63 0 0 1 0 2.54l-1.887 1.505a1.63 1.63 0 0 0-.6 1.447l.261 2.4a1.63 1.63 0 0 1-1.8 1.8l-2.4-.261a1.63 1.63 0 0 0-1.446.6L13.27 22.64a1.63 1.63 0 0 1-2.54 0l-1.511-1.88a1.63 1.63 0 0 0-1.447-.6l-2.4.261a1.627 1.627 0 0 1-1.8-1.8l.261-2.4a1.63 1.63 0 0 0-.6-1.447l-1.88-1.511a1.63 1.63 0 0 1 0-2.54l1.88-1.512a1.63 1.63 0 0 0 .6-1.446l-.261-2.4a1.63 1.63 0 0 1 1.8-1.8l2.4.261a1.63 1.63 0 0 0 1.447-.6z"/></g></svg>
                    </div>
                    <p class="text-light" style="font-size: 18px;">{{text.text}}</p>
            </div>
            }
        </div>

        <div>

        </div>

    </aside>
</section>